<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>[Project] Keypad Watch | By wenop.tk</title>

    <link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Montserrat">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel='stylesheet' href='https://use.fontawesome.com/releases/v5.7.0/css/all.css' integrity='sha384-lZN37f5QGtY3VHgisS14W3ExzMWZxybE1SJSEsQp9S+oqd12jhcu+A56Ebc1zFSJ' crossorigin='anonymous'>

    <style>
        * { margin: 0; padding: 0;}
        /*body, html { height:100%; }*/
        canvas { position: absolute; width: 100%; height: 100% }

        .page-section {
            /*height: 100vh;*/
            padding-right: 50vh;

        }

        header.page-section {
            /*padding-right: 50vh;*/
            padding: 128px 16px 70px;
        }

        #header-content {
            z-index: 100;
        }

        body,h1,h2,h3,h4,h5,h6 {font-family: "Lato", sans-serif}
        .w3-bar,h1,button {font-family: "Montserrat", sans-serif}
        .fa-anchor,.fa-coffee {font-size:200px}

        #three-view {
            background: rgb(96,125,139);
            /*background: linear-gradient(180deg, rgba(96,125,139,1) 20%, rgba(255,255,255,0) 70%);*/
            background: linear-gradient(-90deg, rgba(96,125,139,1) 10%, rgba(255,255,255,0) 100%);
        }

        #circuit-scheme-bg {
            background-image: url('res/photos/scheme.jpg');
            background-position: center;
            background-repeat: no-repeat;
            background-size: cover;"
        }

        .w3-image {
            cursor: pointer;
            opacity: 0.85;
            transition: opacity 0.5s;
        }

        .w3-image:hover {
            opacity: 1;
        }

        /*Loading*/
        .loader {
            border: 16px solid #f3f3f3; /* Light grey */
            border-top: 16px solid #3498db; /* Blue */
            border-radius: 50%;
            width: 120px;
            height: 120px;
            animation: spin 2s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        #loading {
            margin: 50vh 20vh;
            position: fixed;
        }
    </style>

</head>
<body>


<!-- Navbar -->
<div class="w3-top">
    <div class="w3-bar w3-blue-grey w3-card w3-left-align w3-large">
        <a class="w3-bar-item w3-button w3-hide-medium w3-hide-large w3-right w3-padding-large w3-hover-white w3-large w3-blue-grey" href="javascript:void(0);" onclick="myFunction()" title="Toggle Navigation Menu"><i class="fa fa-bars"></i></a>
        <a href="#" class="w3-bar-item w3-button w3-padding-large w3-white">Home</a>
        <a href="https://wenop.tk" class="w3-bar-item w3-button w3-hide-small w3-padding-large w3-hover-white">wenop.tk</a>
    </div>

    <!-- Navbar on small screens -->
    <div id="navDemo" class="w3-bar-block w3-white w3-hide w3-hide-large w3-hide-medium w3-large">
        <a href="https://wenop.tk" class="w3-bar-item w3-button w3-padding-large">Back to wenop.tk</a>
    </div>
</div>

<!-- Header -->
<header class="page-section w3-container w3-blue-grey w3-center">
    <div id="header-content">
        <h1 class="w3-margin w3-jumbo">Keypad Watch</h1>
        <p class="w3-xlarge">Frontpage of the project Keypad Watch</p>
        <button class="w3-button w3-black w3-padding-large w3-large w3-margin-top" onclick="window.location.href='https://github.com/wenoptics/projectKPWatch'">
            <i class="fab fa-github w3-margin-right"></i> GitHub</button>
    </div>
</header>

<!-- First Grid -->
<div class="page-section w3-row-padding w3-padding-64 w3-container">
    <div class="w3-content">
        <h1>Custom Designed & Built</h1>
        <div class="w3-row w3-padding-64">
            <div class="w3-col l8 w3-container w3-cell">
                <h5>
                    <strong>Keypad Watch</strong> is a hobby project that I started and finished during my last gap year (Apr. 2018).
                    It's a little wearable device I planned, designed and built from scratch.
                    Intentionally, this is a wrist watch but has no screen. Numerical information can be displayed by on-and-off of the LEDs on each key.
                </h5>

                <p class="w3-text-grey">
                    Aside from displaying time, the watch itself is a metronome. Adjustable settings includes tempo (in BPM), time signature and note values (e.g. quarter notes, eighth notes and etc.)
                </p>
            </div>

            <div class="w3-col l4 w3-center w3-container w3-cell">
                <img src="res/photos/wear-watch.jpg" alt="kpdwatch" class="w3-image">
            </div>
        </div>
    </div>
</div>

<!-- Second Grid -->
<div class="page-section w3-row-padding w3-light-grey w3-padding-64 w3-container">
    <div class="w3-content">

        <h1>Crafting</h1>
        <div class="w3-row w3-padding-32">

            <div class="w3-col l4 w3-center w3-container w3-cell">
                <img src="res/photos/assembly.jpg" data-hoverimg="res/photos/assembly-mov.gif" alt="" class="w3-image">
            </div>

            <div class="w3-col l8 w3-container w3-cell">
                <h5>
                    The whole project is completed in 3 months, starting from
                    designing the circuit board, making the PCB, programing the chip, and finally designing and 3D-printing this geeky-looking closure.
                </h5>

                <h3>Built with: </h3>
                <ul class="w3-ul w3-hoverable w3-margin-top">
                    <li>Autodesk Fusion 360
                        <span class="w3-right"><img style="height: 1.5em;" src="res/photos/logos/fusion.png"></span></li>
                    <li>Autodesk AutoCAD
                        <span class="w3-right"><img style="height: 1.5em;" src="res/photos/logos/autocad.png"></span></li>
                    <li>Altium Designer 19
                        <span class="w3-right"><img style="height: 1.5em;" src="res/photos/logos/ad.png"></span></li>
                    <li>...</li>
                </ul>

                <p class="w3-text-grey"></p>
            </div>

        </div>
    </div>
</div>

<!-- Grid -->
<div class="page-section w3-row-padding w3-padding-64 w3-container" id="circuit-scheme-bg">
    <div class="w3-content">
        <h1>The heart of the KP Watch</h1>
        <div class="w3-row w3-padding-32">
            <div class="w3-col l6 w3-container w3-cell">
                <h5>
                    A custom built PCB along with a WEMOS D1 Mini provides the electronic backend for the KP Watch.
                    The functionality provided by the custom built PCB includes:
                </h5>

                <ul class="w3-ul w3-hoverable w3-margin-top">
                    <li>Low power clock</li>
                    <li>Vibrator driver</li>
                    <li>Power management (Li-ion Battery)</li>
                    <li>IO extension for the keypads and their LEDs</li>
                </ul>

                <p class="w3-text-grey w3-margin-top">The WEMOS D1 Mini is an Arduino compatible ESP8266 board which provides the WiFi stack.</p>


                <button class="w3-button w3-black w3-padding-large w3-large w3-margin-top">
                    <i class="fas fa-file-pdf w3-margin-right"></i> Scheme PDF
                </button>
            </div>

            <div class="w3-col l6 w3-center w3-container w3-cell w3-margin-top">
                <img src="res/photos/pcb.JPG" data-hoverimg="res/photos/pcb-mov.gif" alt="" class="w3-border w3-image">
            </div>
        </div>
    </div>
</div>

<!-- Grid -->
<div class="page-section w3-row-padding w3-padding-64 w3-light-grey w3-container">
    <div class="w3-content">
        <h1>Closure & 3D Printing</h1>
        <div class="w3-row">
            <div class="w3-col l8 w3-container w3-cell">
                <h5 class="w3-padding-32">
                    Click the image to see a timelapse video for the 3D modeling. See more image in the <strong>Gallery</strong> below.
                </h5>
                <img src="res/photos/timelapse-fusion-thumbnail.gif" alt="" class="w3-image video-thumbnail w3-border"
                     onclick="document.querySelector('#model-display-fusion-timelapse').style.display='block'">
            </div>
        </div>
    </div>
</div>


<div class="page-section w3-container w3-black w3-center w3-opacity w3-padding-64">
    <h1 class="w3-margin w3-xlarge">Great gadget to wear for any Hackathon :-)</h1>
</div>

<!-- Grid -->
<div class="page-section w3-row-padding w3-padding-64 w3-container">
    <div class="w3-content">
        <h1>Gallery</h1>

        <div class="w3-row-padding w3-margin-top">

            <div class="w3-third">
                <div class="w3-card">
                    <img src="res/photos/wear-watch.jpg" style="width:100%">
                    <div class="w3-container">
                        <h4>KP Watch Hands-on</h4>
                    </div>
                </div>
            </div>

            <div class="w3-third">
                <div class="w3-card">
                    <img src="res/photos/pcb-cad-mov.gif" style="width:100%">
                    <div class="w3-container">
                        <h4>PCB CAM</h4>
                    </div>
                </div>
            </div>

            <div class="w3-third">
                <div class="w3-card">
                    <img src="res/photos/rendered-case.png" style="width:100%">
                    <div class="w3-container">
                        <h4>Rendered image</h4>
                    </div>
                </div>
            </div>

        </div>
        <div class="w3-row-padding w3-margin-top">

            <div class="w3-third">
                <div class="w3-card">
                    <img src="res/photos/led-debug.gif" style="width:100%">
                    <div class="w3-container">
                        <h4>LED array debugging</h4>
                    </div>
                </div>
            </div>

            <div class="w3-third">
                <div class="w3-card">
                    <img src="res/photos/wrist-band.png" style="width:100%">
                    <div class="w3-container">
                        <h4>Wrist Band (G-Shock Compatible)</h4>
                    </div>
                </div>
            </div>

            <!--<div class="w3-third">-->
                <!--<div class="w3-card">-->
                    <!--<img src="res/photos/wear-watch.jpg" style="width:100%">-->
                    <!--<div class="w3-container">-->
                        <!--<h4>Vernazza</h4>-->
                    <!--</div>-->
                <!--</div>-->
            <!--</div>-->

        </div>

    </div>
</div>

<!-- Footer -->
<footer class="page-section w3-container w3-padding-64 w3-center w3-opacity" style="margin-top: 40vh">
    <p>Design by <a href="https://wenop.tk" target="_blank">wenop.tk</a></p>
</footer>

<script>
    // Used to toggle the menu on small screens when clicking on the menu button
    function myFunction() {
        var x = document.getElementById("navDemo");
        if (x.className.indexOf("w3-show") == -1) {
            x.className += " w3-show";
        } else {
            x.className = x.className.replace(" w3-show", "");
        }
    }
</script>

<div id="modal-display-image" class="w3-modal" onclick="this.style.display='none'">
    <span class="w3-button w3-hover-red w3-xlarge w3-display-topright">&times;</span>
    <div class="w3-modal-content w3-animate-zoom">
        <img id="model-img" style="width:100%">
    </div>
</div>

<div id="model-display-fusion-timelapse" class="w3-modal" onclick="this.style.display='none'">
    <div class="w3-modal-content w3-animate-zoom" style="width: 560px; height: 315px">
        <iframe style="width: 560px; height: 315px" src="https://www.youtube.com/embed/MeCR3cv6pdk?rel=0&amp;controls=0&amp;showinfo=0" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
    </div>
</div>

<div id="three-view" style="position: fixed; width: 50vh; height: 100vh; right: 0; top: 0">
    <div id="loading" class="loader"></div>
</div>

<script src="https://unpkg.com/three@0.110.0/build/three.js"></script>
<script src="https://unpkg.com/three@0.110.0/examples/jsm/controls/OrbitControls.js"></script>
<script src="https://cdn.jsdelivr.net/npm/animejs@3.0.0/lib/anime.min.js"></script>
<script src="js/loaders/STLLoader.js"></script>
<script>
    
    var PATH_RES = "./res"

    var canvasContainer = document.querySelector('#three-view');

    var scene = new THREE.Scene();
    var camera = new THREE.PerspectiveCamera( 25, canvasContainer.clientWidth / canvasContainer.clientHeight, 0.1, 1000 );

    camera.position.set(0, 5, 5);
    // camera.position.z = 5;
    camera.lookAt(0, 0, 0);

    var light = new THREE.HemisphereLight( 0xeeeeee, 0x888888, 1 );
    light.position.set( 0, 20, 0 );
    scene.add( light );

    // // axes
    // scene.add( new THREE.AxisHelper( 5 ) );

    var renderer = new THREE.WebGLRenderer({antialias: true, alpha: true});
    renderer.setSize( canvasContainer.clientWidth, canvasContainer.clientHeight );
    canvasContainer.appendChild( renderer.domElement );

    // obit controller
    controls = new THREE.OrbitControls(camera, renderer.domElement);
    controls.target = new THREE.Vector3(0, 0, 0);
    controls.enableZoom = false;
    controls.enablePan = false;

    var model_case_upper, model_case_lower;
    var model_keypad_group = new THREE.Group();
    var group_closure = new THREE.Group();

    var groupStates = {
        groupSelectables: [],
        animationDeactivate: {},
        animationActivate: {},
        add: function (obj) {
            if (this.groupSelectables.indexOf(obj) < 0) {
                this.groupSelectables.push(obj);

                // Create animation objects
                this.animationDeactivate[obj] = anime({
                    targets: obj.material,
                    opacity: 0.7,
                    autoplay: false,
                });
                this.animationActivate[obj] = anime({
                    targets: obj.material,
                    opacity: 1,
                    autoplay: false,
                });
            }
        },
        actionSetActive: function (obj) {
            // console.log('actionSetActive: ', obj.material.opacity);
            if (obj.material.opacity === 1) return;
            obj.material.opacity = 1;
            // this.animationDeactivate[obj].pause();
            // this.animationActivate[obj].restart();
        },
        actionSetDeActive: function (obj) {
            // console.log('actionSetDeActive: ',obj.material.opacity);
            if (obj.material.opacity === 0.7) return;
            obj.material.opacity = 0.7;
            // this.animationActivate[obj].pause();
            // this.animationDeactivate[obj].restart();
        }
    };

    var explodeYValues = {
        models: [],
        yValues: []
    };

    var material_plastic = new THREE.MeshPhongMaterial( {
        color: 0xecece7,
        flatShading: true,
        polygonOffset: true,
        polygonOffsetFactor: 1,  // positive value pushes polygon further away
        polygonOffsetUnits: 1,
        transparent: true,
        opacity: 1
    } );

    // Load STL models
    var loader = new THREE.STLLoader();
    loader.load(PATH_RES + '/3dmodels/case-upper.stl', function (geometry) {

        model_case_upper = new THREE.Group();

        // add the mesh
        var mesh = new THREE.Mesh( geometry, material_plastic.clone() );
        model_case_upper.add(mesh);
        groupStates.add(mesh);

        // and the wireFrame
        model_case_upper.add(wireframe.getEdgeModel(geometry));

        // manage the explode y value
        explodeYValues.models.push(model_case_upper);
        explodeYValues.yValues.push(45);

        // model_case_upper.position.set([0, 0, 0]);
        group_closure.add( model_case_upper );

        doAfterModelLoaded();
    });
    loader.load(PATH_RES + '/3dmodels/case-lower.stl', function (geometry) {

        model_case_lower = new THREE.Group();

        // add the mesh
        var mesh = new THREE.Mesh( geometry, material_plastic.clone() );
        model_case_lower.add(mesh);
        groupStates.add(mesh);

        // and the wireFrame
        model_case_lower.add(wireframe.getEdgeModel(geometry));

        // manage the explode y value
        explodeYValues.models.push(model_case_lower);
        explodeYValues.yValues.push(0);

        // model_case_lower.position.set([0, 0, 0]);
        group_closure.add( model_case_lower );
    });
    [1, 2, 3, 4, 5, 6, 7, 8, 9, 0, 'hash'].forEach((kn) => {
        loader.load(PATH_RES + `/3dmodels/key-${kn}.stl`, function (geometry) {

            var _group = new THREE.Group();

            // add the mesh
            var mesh = new THREE.Mesh( geometry, material_plastic.clone() );
            _group.add(mesh);
            groupStates.add(mesh);

            // and the wireFrame
            _group.add(wireframe.getEdgeModel(geometry));

            // model_case_upper.position.set([0, 0, 0]);
            model_keypad_group.add( _group );
        });
    });
    explodeYValues.models.push(model_keypad_group);
    explodeYValues.yValues.push(30);

    [
        ['comp-motor.stl', 10],
        ['comp-switch.stl', 4],
        ['comp-pcb-wemos.stl', 16],
        ['comp-battery.stl', 12],
        ['comp-pcb.stl', 20],
    ].forEach((e) => {
        var model_fn = e[0];
        var explode_y = e[1];
        loader.load('res/3dmodels/'+model_fn, function (geometry) {
            var _group = new THREE.Group();

            // add the mesh
            var mesh = new THREE.Mesh( geometry, material_plastic.clone() );
            _group.add(mesh);
            groupStates.add(mesh);

            // and the wireFrame
            _group.add(wireframe.getEdgeModel(geometry));

            // manage the explode y value
            explodeYValues.models.push(_group);
            explodeYValues.yValues.push(explode_y);

            // model_case_upper.position.set([0, 0, 0]);
            group_closure.add( _group );
        });
    });

    // Grouping
    group_closure.add(model_keypad_group);
    group_closure.scale.set(0.015, 0.015, 0.015);

    function doAfterModelLoaded() {
        document.querySelector('#loading').style.display = 'none';
        scene.add(group_closure);

        setTimeout(function () {
            playExplodeAnimation(4000);
        }, 1000);

        setTimeout(function () {
            playAssemblyAnimation(2000);
        }, 5000);

        anime.timeline()
            // rotation
            .add({
                targets: modelVar,
                rot_y: '+='+Math.PI*1.75,
                cam_y: {
                    value: 2,
                    delay: 1500
                },
                update: function () {
                    group_closure.rotation.y = modelVar.rot_y;
                    camera.position.y = modelVar.cam_y;
                },
                duration: 2000
            })
            .add({
                targets: modelVar,
                rot_y: '+='+Math.PI*0.5,
                cam_y: {
                    value: 5,
                    duration: 5000
                },
                update: function () {
                    group_closure.rotation.y = modelVar.rot_y;
                    camera.position.y = modelVar.cam_y;
                },
                easing: 'easeInOutSine',
                duration: 12000,
                delay: 1000
            });

    }


    var modelVar = {
        rot_y: 0,
        explodeProgress: 0,
        cam_y: 5
    };

    function playRotateAnimation(duration, after) {

        if (duration === undefined) {
            duration = 5000
        }

        anime({
            targets: modelVar,
            rot_y: '+='+Math.PI*1.75,
            update: function () {
                group_closure.rotation.y = modelVar.rot_y
            },
            complete: function () {
                if (after) {
                    after.call();
                }
            },
            duration: duration
        });

    }

    function playExplodeAnimation(duration) {

        if (duration === undefined) {
            duration = 4000
        }

        anime({
            targets: modelVar,
            explodeProgress: 1,
            update: function () {
                for (var i = 0; i < explodeYValues.models.length; i++) {
                    explodeYValues.models[i].position.y = explodeYValues.yValues[i] * modelVar.explodeProgress;
                }
            },
            duration: duration
        });

    }

    function playAssemblyAnimation(duration) {

        if (duration === undefined) {
            duration = 2000
        }

        anime({
            targets: modelVar,
            explodeProgress: 0,
            update: function () {
                for (var i = 0; i < explodeYValues.models.length; i++) {
                    explodeYValues.models[i].position.y = explodeYValues.yValues[i] * modelVar.explodeProgress;
                }
            },
            easing: 'easeOutQuart',
            duration: duration
        });

    }

    var wireframe = {
        mat: new THREE.LineBasicMaterial({color: 0x3a3a3a, linewidth: 1}),
        getEdgeModel: function (geometry) {
            var geo = new THREE.EdgesGeometry(geometry);
            return new THREE.LineSegments(geo, this.mat);
        },
        getWireframeModel: function (geometry) {
            var geo = new THREE.WireframeGeometry(geometry);
            return new THREE.LineSegments(geo, this.mat);
        }
    };

    var raycaster = new THREE.Raycaster();
    var mouse = new THREE.Vector2();

    canvasContainer.addEventListener( 'mousemove', function ( event ) {

        // calculate mouse position in normalized device coordinates
        // (-1 to +1) for both components
        mouse.x = ( (event.clientX - canvasContainer.offsetLeft) / canvasContainer.clientWidth ) * 2 - 1;
        mouse.y = - ( (event.clientY - canvasContainer.offsetTop) / canvasContainer.clientHeight ) * 2 + 1;

        // console.log(event.clientX, event.clientY);

    }, false );

    window.addEventListener('resize', function () {
        camera.aspect = canvasContainer.clientWidth / canvasContainer.clientHeight;
        camera.updateProjectionMatrix();
        renderer.setSize(canvasContainer.clientWidth, canvasContainer.clientHeight);
    });


    function render() {

        window.requestAnimationFrame(render);

        // update orbit controls
        if(controls) {
            controls.update();
        }

        // Raycaster
        // update the picking ray with the camera and mouse position
        raycaster.setFromCamera( mouse, camera );

        // calculate objects intersecting the picking ray
        var intersects = raycaster.intersectObjects( groupStates.groupSelectables , false);

        for (var i = 0; i < groupStates.groupSelectables.length; i++) {
            groupStates.actionSetDeActive(groupStates.groupSelectables[i]);
        }
        if (intersects.length > 0) {
            // only cast on the first hit
            groupStates.actionSetActive(intersects[0].object);
        }

        renderer.render( scene, camera );
    }

    render();

    function updateScrollEffect() {
        var scrollPercentage = window.pageYOffset / (document.body.scrollHeight - window.innerHeight);
        // console.log(scrollPercentage);

        var reservedTop = 0.2;
        if (scrollPercentage > reservedTop) {
            scrollPercentage = (scrollPercentage - reservedTop) / (1 - reservedTop);
            for (var i = 0; i < explodeYValues.models.length; i++) {
                explodeYValues.models[i].position.y = explodeYValues.yValues[i] * scrollPercentage;
            }
        } else {
            // Reset the position (to assembly view)
            for (var i = 0; i < explodeYValues.models.length; i++) {
                explodeYValues.models[i].position.y = 0;
            }
        }
    }

    window.addEventListener('scroll', updateScrollEffect);


</script>
<script>
    document.querySelectorAll('img.w3-image').forEach((el)=>{
        if (el.classList.contains('video-thumbnail')) return;
        el.addEventListener('click', function (evt) {
            document.querySelector('img#model-img').src = evt.target.src;
            document.querySelector('#modal-display-image').style.display = 'block';
        });
        el.addEventListener('mouseenter', function (evt) {
            if (evt.target.dataset.hoverimg) {
                evt.target.dataset.oriimg = evt.target.src;
                evt.target.src = evt.target.dataset.hoverimg;
            }
        });
        el.addEventListener('mouseleave', function (evt) {
            if (evt.target.dataset.hoverimg) {
                evt.target.src = evt.target.dataset.oriimg;
            }
        });
    })
</script>
</body>
</html>
