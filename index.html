<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <style>
        * { margin: 0; padding: 0;}
        body, html { height:100%; }
        canvas { position: absolute; width: 100%; height: 100% }
    </style>
</head>
<body>
<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/102/three.min.js"></script>
<script src="https://cdn.rawgit.com/mrdoob/three.js/master/examples/js/controls/OrbitControls.js"></script>
<script src="https://cdn.jsdelivr.net/npm/animejs@3.0.0/lib/anime.min.js"></script>
<script src="js/loaders/STLLoader.js"></script>
<script>
    var scene = new THREE.Scene();
    var camera = new THREE.PerspectiveCamera( 25, window.innerWidth / window.innerHeight, 0.1, 1000 );
    controls = new THREE.OrbitControls(camera);
    controls.target = new THREE.Vector3(0, 0, 0);

    camera.position.set(0, 5, 5);
    // camera.position.z = 5;
    camera.lookAt(0, 0, 0);

    var light = new THREE.HemisphereLight( 0xeeeeee, 0x888888, 1 );
    light.position.set( 0, 20, 0 );
    scene.add( light );

    // // axes
    // scene.add( new THREE.AxisHelper( 5 ) );

    var renderer = new THREE.WebGLRenderer({antialias: true, alpha: true});
    renderer.setSize( window.innerWidth, window.innerHeight );
    document.body.appendChild( renderer.domElement );

    /*// add a cube
    var geometry = new THREE.BoxGeometry( 1, 1, 1 );
    var material = new THREE.MeshBasicMaterial( { color: 0x00ff00 } );
    var cube = new THREE.Mesh( geometry, material );
    scene.add( cube );*/

    var model_case_upper, model_case_lower;
    var group_closure = new THREE.Group();

    var material_plastic = new THREE.MeshPhongMaterial( {
        color: 0xecece7,
        shading: THREE.FlatShading,
        polygonOffset: true,
        polygonOffsetFactor: 1, // positive value pushes polygon further away
        polygonOffsetUnits: 1
    } );

    var loader = new THREE.STLLoader();
    loader.load('models/case-upper.stl', function (geometry) {

        model_case_upper = new THREE.Group();

        // add the mesh
        var mesh = new THREE.Mesh( geometry, material_plastic );
        model_case_upper.add(mesh);

        // and the wireFrame
        model_case_upper.add(wireframe.getEdgeModel(geometry));

        // model_case_upper.position.set([0, 0, 0]);
        group_closure.add( model_case_upper );
        playRotateAnimation();
    });

    loader.load('models/case-lower.stl', function (geometry) {

        model_case_lower = new THREE.Group();

        // add the mesh
        var mesh = new THREE.Mesh( geometry, material_plastic );
        model_case_lower.add(mesh);

        // and the wireFrame
        model_case_lower.add(wireframe.getEdgeModel(geometry));

        // model_case_lower.position.set([0, 0, 0]);
        group_closure.add( model_case_lower );
    });

    group_closure.scale.set(0.07, 0.07, 0.07);
    scene.add(group_closure);

    function animate() {
        requestAnimationFrame( animate );

        // update orbit controls
        if(controls) {
            controls.update();
        }

        // if (group_closure) {
        //     // model_case_upper.rotation.x += 0.02;
        //     group_closure.rotation.y += 0.01;
        //     // model_case_upper.rotation.z += 0.01;
        // }

        renderer.render( scene, camera );
    }
    animate();

    var modelVar = {
        rot_y: 0,
        model_case_upper_y: 0
    };

    function playRotateAnimation() {

        anime({
            targets: modelVar,
            rot_y: '+='+Math.PI,
            update: function () {
                group_closure.rotation.y = modelVar.rot_y
            },
            duration: 5000
        });

    }

    function playExplodeAnimation() {

        anime({
            targets: modelVar,
            model_case_upper_y: '10',
            update: function () {
                model_case_upper.position.y = modelVar.model_case_upper_y
            },
            duration: 4000
        });

    }

    function playAssemblyAnimation() {

        anime({
            targets: modelVar,
            model_case_upper_y: '0',
            update: function () {
                model_case_upper.position.y = modelVar.model_case_upper_y
            },
            easing: 'easeOutQuart',
            duration: 2000
        });

    }

    var wireframe = {
        mat: new THREE.LineBasicMaterial( { color: 0x3a3a3a, linewidth: 1 } ),
        getEdgeModel: function (geometry) {
            var geo = new THREE.EdgesGeometry( geometry );
            var wireframe = new THREE.LineSegments( geo, this.mat );
            return wireframe;
        },
        getWireframeModel: function (geometry) {
            var geo = new THREE.WireframeGeometry( geometry );
            var wireframe = new THREE.LineSegments( geo, this.mat );
            return wireframe;
        }
    }



</script>
</body>
</html>
